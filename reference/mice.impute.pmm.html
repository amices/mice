<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Imputation by predictive mean matching"><title>Imputation by predictive mean matching — mice.impute.pmm • mice</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Imputation by predictive mean matching — mice.impute.pmm"><meta property="og:description" content="Imputation by predictive mean matching"><meta property="og:image" content="https://amices.org/mice/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mice</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.16.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/overview.html">Overview</a>
    <a class="dropdown-item" href="../articles/oldfriends.html">Help for old friends</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/amices/mice/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Imputation by predictive mean matching</h1>
      <small class="dont-index">Source: <a href="https://github.com/amices/mice/blob/HEAD/R/mice.impute.pmm.R" class="external-link"><code>R/mice.impute.pmm.R</code></a></small>
      <div class="d-none name"><code>mice.impute.pmm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Imputation by predictive mean matching</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mice.impute.pmm</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">ry</span>,</span>
<span>  <span class="va">x</span>,</span>
<span>  wy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  donors <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  matchtype <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  exclude <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quantify <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  trim <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  ridge <span class="op">=</span> <span class="fl">1e-05</span>,</span>
<span>  use.matcher <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>y</dt>
<dd><p>Vector to be imputed</p></dd>


<dt>ry</dt>
<dd><p>Logical vector of length <code>length(y)</code> indicating the
the subset <code>y[ry]</code> of elements in <code>y</code> to which the imputation
model is fitted. The <code>ry</code> generally distinguishes the observed
(<code>TRUE</code>) and missing values (<code>FALSE</code>) in <code>y</code>.</p></dd>


<dt>x</dt>
<dd><p>Numeric design matrix with <code>length(y)</code> rows with predictors for
<code>y</code>. Matrix <code>x</code> may have no missing values.</p></dd>


<dt>wy</dt>
<dd><p>Logical vector of length <code>length(y)</code>. A <code>TRUE</code> value
indicates locations in <code>y</code> for which imputations are created.</p></dd>


<dt>donors</dt>
<dd><p>The size of the donor pool among which a draw is made.
The default is <code>donors = 5L</code>. Setting <code>donors = 1L</code> always selects
the closest match, but is not recommended. Values between 3L and 10L
provide the best results in most cases (Morris et al, 2015).</p></dd>


<dt>matchtype</dt>
<dd><p>Type of matching distance. The default choice
(<code>matchtype = 1L</code>) calculates the distance between
the <em>predicted</em> value of <code>yobs</code> and
the <em>drawn</em> values of <code>ymis</code> (called type-1 matching).
Other choices are <code>matchtype = 0L</code>
(distance between predicted values) and <code>matchtype = 2L</code>
(distance between drawn values).</p></dd>


<dt>exclude</dt>
<dd><p>Dependent values to exclude from the imputation model
and the collection of donor values</p></dd>


<dt>quantify</dt>
<dd><p>Logical. If <code>TRUE</code>, factor levels are replaced
by the first canonical variate before fitting the imputation model.
If false, the procedure reverts to the old behaviour and takes the
integer codes (which may lack a sensible interpretation).
Relevant only of <code>y</code> is a factor.</p></dd>


<dt>trim</dt>
<dd><p>Scalar integer. Minimum number of observations required in a
category in order to be considered as a potential donor value.
Relevant only of <code>y</code> is a factor.</p></dd>


<dt>ridge</dt>
<dd><p>The ridge penalty used in <code><a href="norm.draw.html">.norm.draw()</a></code> to prevent
problems with multicollinearity. The default is <code>ridge = 1e-05</code>,
which means that 0.01 percent of the diagonal is added to the cross-product.
Larger ridges may result in more biased estimates. For highly noisy data
(e.g. many junk variables), set <code>ridge = 1e-06</code> or even lower to
reduce bias. For highly collinear data, set <code>ridge = 1e-04</code> or higher.</p></dd>


<dt>use.matcher</dt>
<dd><p>Logical. Set <code>use.matcher = TRUE</code> to specify
the C function <code>matcher()</code>, the now deprecated matching function that
was default in versions
<code>2.22</code> (June 2014) to <code>3.11.7</code> (Oct 2020). Since version <code>3.12.0</code>
<code><a href="mice.html">mice()</a></code> uses the much faster <code>matchindex</code> C function. Use
the deprecated <code>matcher</code> function only for exact reproduction.</p></dd>


<dt>...</dt>
<dd><p>Other named arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Vector with imputed data, same type as <code>y</code>, and of length
<code>sum(wy)</code></p>


    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Imputation of <code>y</code> by predictive mean matching, based on
van Buuren (2012, p. 73). The procedure is as follows:</p>
<ol><li><p>Calculate the cross-product matrix \(S=X_{obs}'X_{obs}\).</p></li>
<li><p>Calculate \(V = (S+{diag}(S)\kappa)^{-1}\), with some small ridge
parameter \(\kappa\).</p></li>
<li><p>Calculate regression weights \(\hat\beta = VX_{obs}'y_{obs}.\)</p></li>
<li><p>Draw \(q\) independent \(N(0,1)\) variates in vector \(\dot z_1\).</p></li>
<li><p>Calculate \(V^{1/2}\) by Cholesky decomposition.</p></li>
<li><p>Calculate \(\dot\beta = \hat\beta + \dot\sigma\dot z_1 V^{1/2}\).</p></li>
<li><p>Calculate \(\dot\eta(i,j)=|X_{{obs},[i]|}\hat\beta-X_{{mis},[j]}\dot\beta\)
with \(i=1,\dots,n_1\) and \(j=1,\dots,n_0\).</p></li>
<li><p>Construct \(n_0\) sets \(Z_j\), each containing \(d\)
candidate donors, from \(y_{obs}\) such that \(\sum_d\dot\eta(i,j)\) is
minimum for all \(j=1,\dots,n_0\). Break ties randomly.</p></li>
<li><p>Draw one donor \(i_j\) from \(Z_j\) randomly for \(j=1,\dots,n_0\).</p></li>
<li><p>Calculate imputations \(\dot y_j = y_{i_j}\) for \(j=1,\dots,n_0\).</p></li>
</ol><p>The name <em>predictive mean matching</em> was proposed by Little (1988).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Little, R.J.A. (1988), Missing data adjustments in large surveys
(with discussion), Journal of Business Economics and Statistics, 6, 287--301.</p>
<p>Morris TP, White IR, Royston P (2015). Tuning multiple imputation by predictive
mean matching and local residual draws. BMC Med Res Methodol. ;14:75.</p>
<p>Van Buuren, S. (2018).
<a href="https://stefvanbuuren.name/fimd/sec-pmm.html" class="external-link"><em>Flexible Imputation of Missing Data. Second Edition.</em></a>
Chapman &amp; Hall/CRC. Boca Raton, FL.</p>
<p>Van Buuren, S., Groothuis-Oudshoorn, K. (2011). <code>mice</code>: Multivariate
Imputation by Chained Equations in <code>R</code>. <em>Journal of Statistical
Software</em>, <b>45</b>(3), 1-67. <a href="https://doi.org/10.18637/jss.v045.i03" class="external-link">doi:10.18637/jss.v045.i03</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other univariate imputation functions: 
<code><a href="mice.impute.cart.html">mice.impute.cart</a>()</code>,
<code><a href="mice.impute.lasso.logreg.html">mice.impute.lasso.logreg</a>()</code>,
<code><a href="mice.impute.lasso.norm.html">mice.impute.lasso.norm</a>()</code>,
<code><a href="mice.impute.lasso.select.logreg.html">mice.impute.lasso.select.logreg</a>()</code>,
<code><a href="mice.impute.lasso.select.norm.html">mice.impute.lasso.select.norm</a>()</code>,
<code><a href="mice.impute.lda.html">mice.impute.lda</a>()</code>,
<code><a href="mice.impute.logreg.html">mice.impute.logreg</a>()</code>,
<code><a href="mice.impute.logreg.boot.html">mice.impute.logreg.boot</a>()</code>,
<code><a href="mice.impute.mean.html">mice.impute.mean</a>()</code>,
<code><a href="mice.impute.midastouch.html">mice.impute.midastouch</a>()</code>,
<code><a href="mice.impute.mnar.html">mice.impute.mnar.logreg</a>()</code>,
<code><a href="mice.impute.mpmm.html">mice.impute.mpmm</a>()</code>,
<code><a href="mice.impute.norm.html">mice.impute.norm</a>()</code>,
<code><a href="mice.impute.norm.boot.html">mice.impute.norm.boot</a>()</code>,
<code><a href="mice.impute.norm.nob.html">mice.impute.norm.nob</a>()</code>,
<code><a href="mice.impute.norm.predict.html">mice.impute.norm.predict</a>()</code>,
<code><a href="mice.impute.polr.html">mice.impute.polr</a>()</code>,
<code><a href="mice.impute.polyreg.html">mice.impute.polyreg</a>()</code>,
<code><a href="mice.impute.quadratic.html">mice.impute.quadratic</a>()</code>,
<code><a href="mice.impute.rf.html">mice.impute.rf</a>()</code>,
<code><a href="mice.impute.ri.html">mice.impute.ri</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Gerko Vink, Stef van Buuren, Karin Groothuis-Oudshoorn</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># We normally call mice.impute.pmm() from within mice()</span></span></span>
<span class="r-in"><span><span class="co"># But we may call it directly as follows (not recommended)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">53177</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"wgt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">boys</span><span class="op">[</span>, <span class="va">xname</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">boys</span><span class="op">[</span><span class="va">r</span>, <span class="va">xname</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">boys</span><span class="op">[</span><span class="va">r</span>, <span class="st">"tv"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">ry</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ry</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ry</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE  TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   503   224 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># percentage of missing data in tv</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">ry</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ry</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.6918845</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Impute missing tv data</span></span></span>
<span class="r-in"><span><span class="va">yimp</span> <span class="op">&lt;-</span> <span class="fu">mice.impute.pmm</span><span class="op">(</span><span class="va">y</span>, <span class="va">ry</span>, <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">yimp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 503</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">yimp</span>, xlab <span class="op">=</span> <span class="st">"Imputed missing tv"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="mice.impute.pmm-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Impute all tv data</span></span></span>
<span class="r-in"><span><span class="va">yimp</span> <span class="op">&lt;-</span> <span class="fu">mice.impute.pmm</span><span class="op">(</span><span class="va">y</span>, <span class="va">ry</span>, <span class="va">x</span>, wy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">yimp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 727</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">yimp</span>, xlab <span class="op">=</span> <span class="st">"Imputed missing and observed tv"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="mice.impute.pmm-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="va">yimp</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  main <span class="op">=</span> <span class="st">"Predictive mean matching on age, height and weight"</span>,</span></span>
<span class="r-in"><span>  xlab <span class="op">=</span> <span class="st">"Observed tv (n = 224)"</span>,</span></span>
<span class="r-in"><span>  ylab <span class="op">=</span> <span class="st">"Imputed tv (n = 224)"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="mice.impute.pmm-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">yimp</span>, use <span class="op">=</span> <span class="st">"pair"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.7415001</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use blots to exclude different values per column</span></span></span>
<span class="r-in"><span><span class="co"># Create blots object</span></span></span>
<span class="r-in"><span><span class="va">blots</span> <span class="op">&lt;-</span> <span class="fu"><a href="make.blots.html">make.blots</a></span><span class="op">(</span><span class="va">boys</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Exclude ml 1 through 5 from tv donor pool</span></span></span>
<span class="r-in"><span><span class="va">blots</span><span class="op">$</span><span class="va">tv</span><span class="op">$</span><span class="va">exclude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Exclude 100 random observed heights from tv donor pool</span></span></span>
<span class="r-in"><span><span class="va">blots</span><span class="op">$</span><span class="va">hgt</span><span class="op">$</span><span class="va">exclude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">boys</span><span class="op">$</span><span class="va">hgt</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="mice.html">mice</a></span><span class="op">(</span><span class="va">boys</span>, method <span class="op">=</span> <span class="st">"pmm"</span>, print <span class="op">=</span> <span class="cn">FALSE</span>, blots <span class="op">=</span> <span class="va">blots</span>, seed<span class="op">=</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">blots</span><span class="op">$</span><span class="va">hgt</span><span class="op">$</span><span class="va">exclude</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">imp</span><span class="op">$</span><span class="va">imp</span><span class="op">$</span><span class="va">hgt</span><span class="op">)</span><span class="op">)</span> <span class="co"># MUST be all FALSE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [61] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [73] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [85] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [97] FALSE FALSE FALSE FALSE</span>
<span class="r-in"><span><span class="va">blots</span><span class="op">$</span><span class="va">tv</span><span class="op">$</span><span class="va">exclude</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">imp</span><span class="op">$</span><span class="va">imp</span><span class="op">$</span><span class="va">tv</span><span class="op">)</span><span class="op">)</span> <span class="co"># MUST be all FALSE</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE FALSE FALSE FALSE FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Factor quantification</span></span></span>
<span class="r-in"><span><span class="va">xname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"hgt"</span>, <span class="st">"wgt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">br</span> <span class="op">&lt;-</span> <span class="va">boys</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">101</span><span class="op">:</span><span class="fl">110</span>, <span class="fl">501</span><span class="op">:</span><span class="fl">510</span>, <span class="fl">601</span><span class="op">:</span><span class="fl">620</span>, <span class="fl">701</span><span class="op">:</span><span class="fl">710</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">br</span><span class="op">[</span>, <span class="va">xname</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">br</span><span class="op">[</span><span class="va">r</span>, <span class="va">xname</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">br</span><span class="op">[</span><span class="va">r</span>, <span class="st">"tv"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ry</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6  8 10 12 13 15 16 20 25 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1  2  1  1  1  4  1  4  7 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># impute factor by optimizing canonical correlation y, x</span></span></span>
<span class="r-in"><span><span class="fu">mice.impute.pmm</span><span class="op">(</span><span class="va">y</span>, <span class="va">ry</span>, <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 25 25 25 20 25 25 20 25 25 25 15 25 25 25 25 25 15 15 25 15 20 15 8  25 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 25 20 20 15 25 25 15 15 25 25 15 20 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Levels: 6 8 10 12 13 15 16 20 25</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># only categories with at least 2 cases can be donor</span></span></span>
<span class="r-in"><span><span class="fu">mice.impute.pmm</span><span class="op">(</span><span class="va">y</span>, <span class="va">ry</span>, <span class="va">x</span>, trim <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 8  25 25 8  8  20 15 20 20 8  8  8  15 8  20 20 15 8  20 25 20 25 20 15 20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 20 20 20 15 20 15 25 20 25 25 20 20 20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Levels: 6 8 10 12 13 15 16 20 25</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># in addition, eliminate category 20</span></span></span>
<span class="r-in"><span><span class="fu">mice.impute.pmm</span><span class="op">(</span><span class="va">y</span>, <span class="va">ry</span>, <span class="va">x</span>, trim <span class="op">=</span> <span class="fl">2L</span>, exclude <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 8  25 15 25 15 8  8  25 25 25 8  15 15 8  8  8  25 25 25 25 15 8  8  15 15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 25 15 8  15 15 25 25 15 25 25 15 25 25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Levels: 6 8 10 12 13 15 16 20 25</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to get old behavior: as.integer(y))</span></span></span>
<span class="r-in"><span><span class="fu">mice.impute.pmm</span><span class="op">(</span><span class="va">y</span>, <span class="va">ry</span>, <span class="va">x</span>, quantify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 8  6  10 15 12 8  6  15 15 10 10 6  8  10 8  15 8  15 8  15 15 12 15 8  20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 25 12 25 15 25 25 13 8  20 16 20 20 20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Levels: 6 8 10 12 13 15 16 20 25</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stef van Buuren, Karin Groothuis-Oudshoorn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

